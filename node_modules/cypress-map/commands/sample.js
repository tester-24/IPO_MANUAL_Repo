/// <reference types="cypress" />
var registerQuery = require('./utils').registerQuery;
registerQuery('sample', function (n) {
    if (n === void 0) { n = 1; }
    if (n < 1) {
        throw new Error("Sample size should be positive, was ".concat(n));
    }
    if (n === 1) {
        var log = Cypress.log({ name: 'sample' });
        return function (subject) {
            var _a, _b, _c, _d;
            // console.log('pick 1 sample')
            if (Cypress.dom.isJquery(subject)) {
                var randomElement = Cypress._.sample(subject.toArray());
                // wrap into jQuery object so other commands
                // can be attached, like cy.click
                return Cypress.$(randomElement);
            }
            // console.log('picked sample', sample)
            var currCommand = cy.state('current').attributes;
            if (currCommand.name === 'as' &&
                ((_a = currCommand.args[1]) === null || _a === void 0 ? void 0 : _a.type) === 'static') {
                // console.log(
                //   'current command',
                //   cy.state('current').attributes.name,
                // )
                if (((_d = (_c = (_b = cy.state('current').attributes) === null || _b === void 0 ? void 0 : _b.prev) === null || _c === void 0 ? void 0 : _c.attributes) === null || _d === void 0 ? void 0 : _d.name) ===
                    'sample') {
                    // console.log(cy.state('current').attributes.prev.attributes)
                    var prevSubject = cy.state('current').attributes.prev.attributes.subject;
                    // console.log('returning prev sampled subject', prevSubject)
                    return prevSubject;
                }
            }
            var sample = Cypress._.sample(subject);
            // console.log(cy.state('current').attributes.name)
            // console.log(cy.state('current').attributes)
            // console.log('sampled subject', sample)
            // debugger
            return sample;
        };
    }
    else {
        var log = Cypress.log({ name: 'sample', message: String(n) });
        return function (subject) {
            // console.log('pick N samples')
            if (Cypress.dom.isJquery(subject)) {
                var randomElement = Cypress._.sampleSize(subject.toArray(), n);
                // wrap into jQuery object so other commands
                // can be attached, like cy.click
                return Cypress.$(randomElement);
            }
            return Cypress._.sampleSize(subject, n);
        };
    }
});
